#Generated by Edalize
ifndef MODEL_TECH
$(error Environment variable MODEL_TECH was not found. It should be set to <modelsim install path>/bin)
endif

CC ?= gcc
CFLAGS := -c -std=c99 -fPIC -fno-stack-protector -g

LD ?= ld
LDFLAGS := -shared -E

#Try to determine if ModelSim is 32- or 64-bit.
#To manually override, set the environment MTI_VCO_MODE to 32 or 64
ifeq ($(findstring 64, $(shell $(MODEL_TECH)/../vco)),)
CFLAGS  += -m32
LDFLAGS += -melf_i386
endif

RM ?= rm
INCS := -I$(MODEL_TECH)/../include

VSIM ?= $(MODEL_TECH)/vsim

TOPLEVEL      := top_module
VPI_MODULES   := 
PARAMETERS    ?= vlogparam_bool=1 vlogparam_int=42 vlogparam_str=hello
PLUSARGS      ?= plusarg_bool=1 plusarg_int=42 plusarg_str=hello
VSIM_OPTIONS  ?= a few vsim_options
SDF_OPTIONS   ?= -sdfmin /tb/uut_min=min.sdf -sdfmax max.sdf -sdftyp typ.sdf
EXTRA_OPTIONS ?= $(VSIM_OPTIONS) $(addprefix -g,$(PARAMETERS)) $(addprefix +,$(PLUSARGS))
VPI_OPTIONS   := $(addprefix -pli ,$(VPI_MODULES))
VSIM_ARGS     := $(VPI_OPTIONS) $(SDF_OPTIONS) $(EXTRA_OPTIONS) $(TOPLEVEL)

all: work $(VPI_MODULES)

run: work $(VPI_MODULES)
	$(VSIM) -do edalize_run.tcl -c $(VSIM_ARGS)

run-gui: work $(VPI_MODULES)
	$(VSIM) -gui $(VSIM_ARGS)

work:
	$(VSIM) -c -do "do edalize_main.tcl; exit"

clean: 
